<?xml version="1.0" encoding="UTF-8" ?>
<Module>
	<ModulePrefs title="BasketDB Gadget" 
		author="Kob">
		<Require feature="pubsub-2">
			<Param name="topics">
				<Topic title="GFBio BasketDB" name="gfbio.search.basketdb"
					description="Interaction with Basket DB" type="string" subscribe="true" publish="true" />
			</Param>
		</Require>
		<Require feature="dynamic-height" />
	</ModulePrefs>
	<Content type="html">
	<![CDATA[
	<!DOCTYPE html>
		<html>
			<head>
				<title>Interaction with Basket DB</title>
				<script src="http://gfbio-dev1.inf-bb.uni-jena.de/gfbio/search/js/jquery-1.10.2.js"	type="text/javascript"></script>
				<script src="http://gfbio-dev1.inf-bb.uni-jena.de/gfbio/search/js/jquery-1.10.2-ui.js"	type="text/javascript"></script>
				<script type="text/javascript">
				    console.log('test basket DB');
				    function addBasket(){
    				    var uid = parent.Liferay.ThemeDisplay.getUserId();
    					console.log(uid);
    					var basketid = 0;
    					var name = document.getElementById("basket_name").value;
    					var val = document.getElementById("basket_val").value;
    					var query = document.getElementById("basket_query").value;
    					parent.Liferay.Service(
                          '/GFBioProject-portlet.basket/update-basket',
                          {
                            basketID: basketid,
                            userID: uid,
                            name: name,
                            basketJSON: val,
                            queryJSON: query
                          },
                          function(obj) {
                            console.log(obj);
                            var displaytext = obj;
            				var div = document.getElementById('basket_result');
            				div.innerHTML = displaytext;
            				document.getElementById("basket_id").value = '';
            				adjust();
                          }
                        );
				    }
				    function getBasket(){
    				    var uid = parent.Liferay.ThemeDisplay.getUserId();
    					console.log(uid);
    					parent.Liferay.Service(
                            '/GFBioProject-portlet.basket/get-basket-list',
                            {
                                userID: uid
                            },
                            function(obj) {
                                var objStr = JSON.stringify(obj);
                                console.log(objStr);
                                var displaytext = objStr;
            					var div = document.getElementById('basket_result');
            					div.innerHTML = displaytext;
            					document.getElementById("basket_id").value = '';
            					adjust();
                            }
                        );
				    }
				    
				    function removeBasket(){
    					var basketid = document.getElementById("basket_id").value;
    					console.log(basketid);
    					parent.Liferay.Service(
                          '/GFBioProject-portlet.basket/remove-basket',
                          {
                            basketID: basketid
                          },
                          function(obj) {
                            var objStr = JSON.stringify(obj);
                            console.log(objStr);
                            var displaytext = objStr;
            				var div = document.getElementById('basket_result');
            				div.innerHTML = displaytext;
            				document.getElementById("basket_id").value = '';
            				adjust();
                          }
                        );
				    }
				    
    				function adjust() {
    				   //console.log('auto adjust height');
    				   var height = $('#basket_div').height()+20;
    				   if (height < 350){ 
    						height = 350;
    				   }
    					gadgets.window.adjustHeight(height);
    				}
				</script>
			</head>
			<body>
			    <div id="basket_div">
    			    <div id="basket_input">
    			        <input id="basket_name" 
    						type="text" value="Name"
    						autocomplete="off"/> <br/>
    			        <input id="basket_val" 
    						type="text" value="Selected Value"
    						autocomplete="off"/> <br/>
    			        <input id="basket_query" 
    						type="text" value="Query String"
    						autocomplete="off"/> <br/>
        				<input id="UpdateButton"
    						type="button" value="Update" 
    						onclick="javascript:addBasket();" />
    
    			    </div>
    			    <div>
    			    	<input id="QueryButton"
    						type="button" value="Get Basket"
    						onclick="javascript:getBasket();" />
    			    </div>
    				<div>
    			        <input id="basket_id" 
    						type="text" value="Basket ID"
    						autocomplete="off"/> 
        				<input id="RemoveButton"
    						type="button" value="Remove Basket" 
    						onclick="javascript:removeBasket();" />
    				</div>
    			    <div id="basket_result" style="overflow-y: scroll;">
    			    </div>
    			 </div>
			</body>
		</html>
	]]>
	</Content>
</Module>